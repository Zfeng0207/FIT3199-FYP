<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cardiovascular Risk Assessment</title>

  <!-- 1) Tailwind CSS (load first to scope Reset here) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/stroke_prediction_style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation_bar_style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/about_us_style.css') }}" />

  <style>
    /* 1) container only shrinks in width, but stays the same height as the nav */
    #cs-navigation .cs-logo {
      width: auto     !important;
      height: 4.0625rem !important; /* back to the default desktop height */
      overflow: visible;            /* let your hero-text spill out if you’re using negative margins */
      transform: translateX(-65px) !important;
    }

    /* 1) Allow the dropdown to overflow the nav without resizing it */
    #cs-navigation,
    #cs-navigation .cs-container,
    #cs-navigation .cs-ul-wrapper {
      overflow: visible !important;
    }

    /* 2) Desktop: make the submenu absolute, vertical, and add gap */
    @media only screen and (min-width: 64rem) {
      #cs-navigation .cs-dropdown {
        position: relative; /* ensure absolute child is positioned off the li */
      }
      #cs-navigation .cs-dropdown .cs-drop-ul {
        position: absolute !important; /* take it out of the document flow */
        top: 100% !important;          /* sit directly below the menu item */
        left: 0 !important;
        display: flex !important;       /* flex‑column gives us true gaps */
        flex-direction: column !important;
        gap: 1rem !important;           /* increase vertical space between links */
        padding: 0.2rem 0 !important;   /* optional breathing room above/below */
        margin: 0 !important;           /* reset any built‑in margins */
      }
    }

    /* 3) Mobile: same absolute behavior so it won’t push content down */
    @media only screen and (max-width: 63.9375rem) {
      #cs-navigation .cs-dropdown .cs-drop-ul {
        position: absolute !important;
        top: 100% !important;
        left: 0 !important;
        display: flex !important;
        flex-direction: column !important;
        gap: 1rem !important;
        margin: 0 !important;
        padding: 0.5rem 0 !important;
      }
    }
  </style>  
</head>

<body class="bg-gray-50 p-0">

  <!-- ============================================ -->
  <!--                 Navigation                   -->
  <!-- ============================================ -->
  <header id="cs-navigation" class="fixed top-0 left-0 w-full z-50 bg-white shadow-md">
    <div class="cs-container">
      <a href="{{ url_for('home') }}" class="cs-logo" aria-label="back to home">
        <!-- larger logo via utility classes -->
        <img src="{{ url_for('static', filename='images/stroke_hero_text.svg') }}" class="hero-text" alt="Stroke Hero Logo" decoding="async"/>
      </a>
      <nav class="cs-nav" role="navigation">
        <button class="cs-toggle" aria-label="mobile menu toggle">
          <div class="cs-box">
            <span class="cs-line cs-line1"></span>
            <span class="cs-line cs-line2"></span>
            <span class="cs-line cs-line3"></span>
          </div>
        </button>
        <div class="cs-ul-wrapper">
          <ul id="cs-expanded" class="cs-ul" aria-expanded="false">
            <li class="cs-li"><a href="{{ url_for('home') }}" class="cs-li-link">Welcome</a></li>
            <li class="cs-li"><a href="{{ url_for('chatbot_routing') }}" class="cs-li-link">Chatbot</a></li>
            <li class="cs-li"><a href="{{ url_for('about_us_routing') }}" class="cs-li-link">About Us</a></li>
            {% if user %}
            <li class="cs-li"><a href="{{ url_for('stroke_prediction_routing') }}" class="cs-li-link">Stroke Prediction</a></li>
            {% endif %}
            <li class="cs-li cs-dropdown">
              <!-- top‐level link stays as your Self Assessment page -->
              <a href="{{ url_for('self_assesment_routing') }}"
                 class="cs-li-link cs-drop-link">
                Self Assessment
                <svg class="cs-drop-icon" viewBox="0 0 10 6" aria-hidden="true">
                  <path d="M0 0l5 6 5-6z" fill="currentColor"/>
                </svg>
              </a>
              <!-- submenu items are now absolute, vertical, and spaced out -->
              <ul class="cs-drop-ul">
                <li class="cs-drop-li">
                  <a href="{{ url_for('self_assesment_routing') }}"
                     class="cs-li-link">
                    ASCVD Risk Estimator
                  </a>
                </li>
                <li class="cs-drop-li">
                  <a href="{{ url_for('abcd2_tia_routing') }}"
                     class="cs-li-link">
                    ABCD² Score for TIA
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
      {% if user %}
      <a href="{{ url_for('logout') }}" class="cs-button-solid cs-nav-button" style="background: linear-gradient(45deg, #0d3e4b, #0eafd7);">Logout</a>
      {% else %}
      <a href="{{ url_for('login') }}" class="cs-button-solid cs-nav-button" style="background: linear-gradient(45deg, #0d3e4b, #0eafd7);">Login</a>
      {% endif %}
    </div>
  </header>

  <!-- Services Section -->
  <section id="services-285">
    <div class="cs-container">
      <div class="cs-content">
        <br><br><br><br><br><br>
        <h2 class="cs-title">Data Entry & Prediction</h2>
      </div>
      <ul class="cs-card-group">
        <li class="cs-item">
          <a href="#" class="cs-link">
            <picture class="cs-picture">
              <img class="cs-icon" src="https://www.svgrepo.com/show/532228/table-list.svg" alt="icon" width="38" height="52">
            </picture>
            <h3 class="cs-h3">Step 1</h3>
            <p class="cs-item-text">Download our CSV template and fill in the required columns.</p>
          </a>
        </li>
        <li class="cs-item">
          <a href="#" class="cs-link">
            <picture class="cs-picture">
              <img class="cs-icon" src="https://www.svgrepo.com/show/5500/upload-file.svg" alt="icon" width="38" height="52">
            </picture>
            <h3 class="cs-h3">Step 2</h3>
            <p class="cs-item-text">Upload the completed template and click submit.</p>
          </a>
        </li>
        <li class="cs-item">
          <a href="#" class="cs-link">
            <picture class="cs-picture">
              <img class="cs-icon" src="https://www.svgrepo.com/show/486820/report-text.svg" alt="icon" width="38" height="52">
            </picture>
            <h3 class="cs-h3">Step 3</h3>
            <p class="cs-item-text">Our model will analyze and return a prediction report.</p>
          </a>
        </li>
      </ul>
      <a href="#" class="cs-button-solid" style="background-color: rgb(58, 58, 237); color: white;">Download CSV Template</a>
    </div>
  </section>

  <!-- File upload -->
  <div class="formbold-main-wrapper">
    <div class="formbold-form-wrapper">
      <form id="processForm">
        <label class="formbold-form-label">Upload .npy memmap file</label>
        <input type="file" id="npyFile" accept=".npy" class="formbold-input" />

        <div><br>
          <button class="formbold-btn w-full" type="submit">Process Data</button>
        </div>

        <!-- loading overlay -->
        <div class="loader-overlay" id="loader" style="display: none;">
          <div class="loader"></div>
        </div>

        <!-- prediction output -->
        <div class="formbold-mt-4">
          <label class="formbold-form-label">Model Output</label>
          <textarea id="outputBox" class="formbold-textarea" rows="8" readonly
            placeholder="Your prediction will appear here…"></textarea>
        </div>
      </form>
    </div>
  </div>

  <script>
    const loader    = document.getElementById('loader');
    const npyInput  = document.getElementById('npyFile');
    const outputBox = document.getElementById('outputBox');

    document.getElementById('processForm').addEventListener('submit', async e => {
      e.preventDefault();
      if (!npyInput.files[0]) {
        alert('Please upload your .npy memmap file.');
        return;
      }

      loader.style.display = 'flex';

      const formData = new FormData();
      formData.append('npy_file', npyInput.files[0]);

      try {
        const res   = await fetch('/predict_memmap', {
        method: 'POST',
        body: formData
      });

      // pull down the plain‐text DataFrame repr
      const text  = await res.text();

      if (!res.ok) {
        outputBox.value = `Error: ${text}`;
      } else {
        outputBox.value = text;
      }
      } catch (err) {
        outputBox.value = `Request failed: ${err.message}`;
      } finally {
        loader.style.display = 'none';
      }
    });
  </script>


</body>
</html>